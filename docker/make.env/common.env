##
## Common Make envs (readability-first)
##
## How to use
## - Defaults live here. Local overrides go in common.local.env (gitignored).
## - Only edit the User Config section in most cases.
## - Secrets MUST be set in common.local.env, not here.

### User Config — project/app
PROJECT_NAME=schematic                 # Image/DB naming: project part
APP_NAME=base                          # Image/DB naming: app part
APP_HOME=/home/app                     # In-container app home
SCHEMATIC_HOME=/home/schematic         # In-container schematic home
ENV_HOME=/home/env                     # In-container env files home

### User Config — docker
IMAGE_REPO_ROOT=quay.io/colinchan2025       # Root image repository
CONTAINER_CLI=docker                   # docker|podman
# CONTAINER_CLI=podman

### Host paths (for this repo's compose)
# Run-time app mount path
HOST_APP_DIR_RUN?=../../test

### Derived — dev image
DEV_IMAGE_REPO=${IMAGE_REPO_ROOT}/${PROJECT_NAME}_${APP_NAME}
DEV_IMAGE_VERSION=$(shell cat ../VERSION)
DEV_IMAGE_RELEASE_TAG=rel
DEV_IMAGE_BUILD_NUMBER=0
DEV_IMAGE_TAG=${DEV_IMAGE_VERSION}-${DEV_IMAGE_RELEASE_TAG}.${DEV_IMAGE_BUILD_NUMBER}
DEV_IMAGE=${DEV_IMAGE_REPO}:${DEV_IMAGE_TAG}

### User Config — database (common)
DEV_DB_HOST=dev.db                     # DB service hostname
DEV_DB_NAME=schematic                  # DB name (override as needed)
DEV_DB_TYPE=mssql                      # mssql|psql
# DEV_DB_TYPE=psql

### DB: MSSQL (applies when DEV_DB_TYPE=mssql)
ifeq ($(DEV_DB_TYPE),mssql)
  DEV_DB_IMAGE=mcr.microsoft.com/mssql/server:2022-CU10-ubuntu-20.04
  DB_HOME=/home/mssql
  DEV_DB_ADAPTER=pytds
  DEV_DATABASE_URL=${DEV_DB_ADAPTER}://${DEV_DB_HOST}/${DEV_DB_NAME}
  # Credentials (set in common.local.env)
  DEV_DB_USER?=SVC_DS_DEPLOY
  MSSQL_SA_PASSWORD?=
  DEV_DB_PASSWORD?=
  DEV_DB_PASSWORD_ENCRYPTED?=
endif

### DB: PostgreSQL (applies when DEV_DB_TYPE=psql)
ifeq ($(DEV_DB_TYPE),psql)
  DEV_DB_IMAGE=postgres:16.0-alpine3.18
  # DEV_DB_IMAGE=postgres:15.4-alpine3.18
  POSTGRES_DB=${DEV_DB_NAME}
  DB_HOME=${APP_HOME}
  DEV_DB_ADAPTER=postgres
  DEV_DATABASE_URL=${DEV_DB_ADAPTER}://${DEV_DB_HOST}/${DEV_DB_NAME}
  # Credentials (set in common.local.env)
  POSTGRES_USER?=postgres
  POSTGRES_PASSWORD?=
  DEV_DB_USER?=${POSTGRES_USER}
  DEV_DB_PASSWORD?=${POSTGRES_PASSWORD}
  DEV_DB_PASSWORD_ENCRYPTED?=
endif

### Cipher
DEV_CIPHER_ALGORITHM=RS256             # Algorithm for cipher tasks
DEV_CIPHER_KEY_LENGTH=4096             # RSA key length
DEV_CIPHER_ISSUER=schematic            # Token issuer
