##
## Common Make envs (readability-first)
##
## How to use
## - Defaults live here. Local overrides go in common.local.env (gitignored).
## - Only edit the User Config section in most cases.
## - Secrets MUST be set in common.local.env, not here.

### User Config — project/app
# Image/DB naming: project part
PROJECT_NAME=SCHEMATIC__PROJECT_NAME
# Image/DB naming: app part
APP_NAME=SCHEMATIC__APP_NAME
APP_HOME=/home/app                     # In-container app home
SCHEMATIC_HOME=/home/schematic         # In-container schematic home
ENV_HOME=/home/env                     # In-container env files home

### User Config — docker
# Root image repository
IMAGE_REPO_ROOT=quay.io/colinchan2025
# docker|podman
CONTAINER_CLI=docker
# CONTAINER_CLI=podman

### Host paths
# Build-time app source path (used by image build)
HOST_APP_DIR_BUILD?=../../../src
# Run-time app mount path (used by compose; also has default in compose file)
HOST_APP_DIR_RUN?=../../src

### Base image (used as dev image by default)
DEV_BASE_IMAGE_NAME=flink
DEV_BASE_IMAGE_VERSION=SCHEMATIC__BASE_VERSION
DEV_BASE_IMAGE_RELEASE_TAG=rc
DEV_BASE_IMAGE_BUILD_NUMBER=0
DEV_BASE_IMAGE_REPO=${IMAGE_REPO_ROOT}/${DEV_BASE_IMAGE_NAME}
DEV_BASE_IMAGE_TAG=${DEV_BASE_IMAGE_VERSION}-${DEV_BASE_IMAGE_RELEASE_TAG}.${DEV_BASE_IMAGE_BUILD_NUMBER}
DEV_BASE_IMAGE=${DEV_BASE_IMAGE_REPO}:${DEV_BASE_IMAGE_TAG}

### Dev image (defaults to base image)
DEV_IMAGE_REPO=${DEV_BASE_IMAGE_REPO}
DEV_IMAGE_TAG=${DEV_BASE_IMAGE_TAG}
DEV_IMAGE_TAG=latest
DEV_IMAGE=${DEV_IMAGE_REPO}:${DEV_IMAGE_TAG}

### User Config — database (common)
DEV_DB_HOST=dev.db                     # DB service hostname
DEV_DB_NAME=$(subst -,_,${PROJECT_NAME})_$(subst -,_,${APP_NAME})
# mssql|psql
DEV_DB_TYPE=SCHEMATIC__DB_TYPE

### DB: MSSQL (applies when DEV_DB_TYPE=mssql)
ifeq ($(DEV_DB_TYPE),mssql)
  DEV_DB_IMAGE=mcr.microsoft.com/mssql/server:2022-CU9-ubuntu-20.04
  # DEV_DB_IMAGE=mcr.microsoft.com/mssql/server:2019-CU23-ubuntu-20.04
  DB_HOME=/home/mssql
  DEV_DB_ADAPTER=pytds
  DEV_DATABASE_URL=${DEV_DB_ADAPTER}://${DEV_DB_HOST}/${DEV_DB_NAME}
  # Credentials (set in common.local.env)
  DEV_DB_USER?=SVC_DS_DEPLOY
  MSSQL_SA_PASSWORD?=
  DEV_DB_PASSWORD?=
  DEV_DB_PASSWORD_ENCRYPTED?=
endif

### DB: PostgreSQL (applies when DEV_DB_TYPE=psql)
ifeq ($(DEV_DB_TYPE),psql)
  DEV_DB_IMAGE=postgres:16.0-alpine3.18
  # DEV_DB_IMAGE=postgres:15.4-alpine3.18
  POSTGRES_DB=${DEV_DB_NAME}
  DB_HOME=${APP_HOME}
  DEV_DB_ADAPTER=postgres
  DEV_DATABASE_URL=${DEV_DB_ADAPTER}://${DEV_DB_HOST}/${DEV_DB_NAME}
  # Credentials (set in common.local.env)
  POSTGRES_USER?=postgres
  POSTGRES_PASSWORD?=
  DEV_DB_USER?=${POSTGRES_USER}
  DEV_DB_PASSWORD?=${POSTGRES_PASSWORD}
  DEV_DB_PASSWORD_ENCRYPTED?=
endif

### Cipher
DEV_CIPHER_ALGORITHM=RS256             # Algorithm for cipher tasks
DEV_CIPHER_KEY_LENGTH=4096             # RSA key length
DEV_CIPHER_ISSUER=schematic            # Token issuer
